<!DOCTYPE html>
<html>
<head>
	<title>API Assignment</title>
	<script language="javascript" src="//wc.mediamath.com/loader.js?p=compass"></script>
	<link rel="import" href="//wc.mediamath.com/index.html"/>
</head>
<body>
<polymer-element name="ajax-test">
	<template>
	<link href="api-assignment.css" rel="stylesheet" type="text/css"/>
			<mm-ajax id="a1" url="{{url}}" auto response="{{response}}"  method="GET"></mm-ajax>
			<mm-ajax id="a2" url="{{urladv}}" auto response="{{responseAdv}}"  method="GET"></mm-ajax>
			<mm-ajax id="a3" url="{{urlcam}}" auto response="{{responseCam}}"  method="GET"></mm-ajax>
		<template id="dropdown" bind>
			<div class="agenDrop">
				<label>Agency</label>
				<mm-dropdown id="agenciesDrop" fitparent="true" value="{{agencySelected}}" placeholder="Select Agency">
					<template id="agencyNames" repeat="{{agencies}}">
					<mm-list-item>{{name}}</mm-list-item>
					</template>
				</mm-dropdown>
				<label>Advertiser</label>
				<mm-dropdown id="advList" fitparent="true" placeholder="Select Advertiser">
					<template id="advertiserNames" repeat="{{advNames}}" >
					<mm-list-item>{{name}}</mm-list-item>
					</template>
				</mm-dropdown>
				<mm-button id="getId" on-click="{{getAdv}}"><label>GetName adv</label></mm-button>
				<mm-button on-click="{{getCamp}}"><label>Get Campaigns</label></mm-button>
			</div>
		</template>	
		<template bind>
			<div id="gridTable" hidden = "true" >
				<table>
					<tr>
						<th><mm-checkbox></mm-checkbox></th>
						<th>Campaign Name</th>
						<th>Status</th>
						<th>Budget</th>
						<th>Start Date</th>
						<th>End Date</th>
					</tr>
					<template repeat="{{campNames}}">
						<tr>
							<td><mm-checkbox checked="{{checked}}"></mm-checkbox></td>
							<td><mm-textarea value="{{name}}"></mm-textarea></td>
							<td>
								<mm-dropdown placeholder="status">
									<mm-list-item>active</mm-list-item>
									<mm-list-item>inactive</mm-list-item>
								</mm-dropdown>
							</td>
							<td><mm-textarea value="{{budget}}"></mm-textarea></td>
							<td><mm-textarea value="{{start_date}}"></mm-textarea></td>
							<td><mm-textarea value="{{end_date}}"></mm-textarea></td>
						</tr>
					</template>
				</table>
				<mm-button id="campSave" on-click="{{saveCampaign}}"><label>Save</label></mm-button>
			</div>
			
		</template>	
	</template>

	<script type="text/javascript">
    Polymer("ajax-test", {
    	url:'http://challenge.mediamath.com/api/agencies'+'?api_token=dd88982667b3ec6896d6a3a50d80efa3faea6923',
    	urladv:'http://challenge.mediamath.com/api/advertisers'+'?api_token=dd88982667b3ec6896d6a3a50d80efa3faea6923',
    	urlcam:'http://challenge.mediamath.com/api/campaigns'+'?api_token=dd88982667b3ec6896d6a3a50d80efa3faea6923',
    	text1:'',
    	urlObject:[],
    	advObject:[],
    	camObject:[],
    	agencies:[],
    	advertisers:[],
    	campaigns:[],
    	advNames:[],
    	campNames:[],
    	agencySelected:'',
    	agencyID:'',
    	advId:'',

    	
    	
        agenId: function(){
        	var i = this.agencies.length;
        	while(i--){
        		if(this.agencies[i].name == this.agencySelected){
        			this.agencyID = this.agencies[i]._id;
        		}
        	}
        },

        getAdv: function(){
        	this.agenId();
        	this.$.advList.placeholder="advertisers Names";
        	this.advNames = [];
        	var i = this.advertisers.length;
        	while(i--){
        		if(this.advertisers[i].agency_id == this.agencyID){
        			this.advNames.push({name:this.advertisers[i].name ,id:this.advertisers[i]._id});
        			console.log(this.advertisers[i].name);
        			
        		}
        	}
        },
        getAdvId: function() {
        	var i = this.advNames.length
        	while(i--){
        		if(this.advNames[i].name == this.$.advList.value){
        			 this.advId = this.advNames[i].id;
        		}
        	}
        	
        },
        getCamp:function() {
        	this.getAdvId();
        	this.campNames = [];
        	var i = this.campaigns.length;
        	while(i--){
        		if(this.campaigns[i].advertiser_id == this.advId){
        			this.campNames.push(this.campaigns[i]);
        			

        		}

        	}
        	console.log(this.campNames);
        	this.$.gridTable.hidden = false;
        	
        },

    	responseChanged: function(_old, _new) {
     
          		this.urlObject = this.response;
        		this.agencies = this.urlObject.agencies;
     	    	
      	},
      	responseAdvChanged: function(_old, _new){
      		this.advObject = this.responseAdv;
      		this.advertisers = this.advObject.advertisers;
     	   
      	},
  		responseCamChanged: function(_old, _new){
	  		this.camObject = this.responseCam;
	  		this.campaigns = this.camObject.campaigns;
	 	    
      	},

      	saveCampaign: function() {
      		alert("The Campaign has been saved Successfully");
      	}

    });

	</script>
</polymer-element>
<ajax-test></ajax-test>
</body>

</html>